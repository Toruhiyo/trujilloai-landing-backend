files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/01_websocket_logging.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      
      # Create a custom log configuration for WebSocket debugging
      cat > /etc/nginx/conf.d/websocket_logging.conf<< 'EOF'
      log_format websocket_log '$remote_addr - $remote_user [$time_local] '
                           '"$request" $status $body_bytes_sent '
                           '"$http_referer" "$http_user_agent" '
                           '"$http_upgrade" "$http_connection" "$request_uri"';
      
      # Apply this log format to the server
      access_log /var/log/nginx/websocket_access.log websocket_log;
      EOF
      
      # Reload Nginx to apply the new log format
      service nginx reload || service nginx restart
      
      # Add enhanced application logging
      echo "Application logging configuration completed"
      
  "/opt/elasticbeanstalk/tasks/taillogs.d/websocket-logs.conf":
    mode: "000755"
    owner: root
    group: root
    content: |
      /var/log/nginx/websocket_access.log
      
  "/opt/elasticbeanstalk/tasks/bundlelogs.d/websocket-logs.conf":
    mode: "000755"
    owner: root
    group: root
    content: |
      /var/log/nginx/websocket_access.log

container_commands:
  01_restart_nginx:
    command: "sudo service nginx reload || sudo service nginx restart" 